---
import { Menu, X } from 'lucide-react';
const { pathname } = Astro.url;
const isHomepage = pathname === '/';
---

<header id="main-header" class:list={[
  "fixed top-0 left-0 right-0 z-50 transition-all duration-300",
  { 'scrolled': !isHomepage }
]}>
  <div class="container mx-auto px-4 flex items-center justify-between h-20">
    <a href="/" id="header-logo">
      <img 
        src="/images/logo-white.svg" 
        alt="M&T Company Logo" 
        id="header-logo-img"
        class="h-12 w-auto"
      />
    </a>
    <nav class="hidden md:flex items-center space-x-8" id="desktop-nav">
      <a href="/services" class="transition-colors">Services</a>
      <a href="/about" class="transition-colors">About Us</a>
      <a href="/team" class="transition-colors">Team</a>
      <a href="/#contact" class="transition-colors">Contact Us</a>
    </nav>
    <button class="md:hidden" id="menu-button">
      <Menu id="menu-icon" />
    </button>
  </div>
</header>

<div id="mobile-menu" class="fixed top-0 left-0 right-0 bottom-0 bg-warm-white z-50 hidden">
  <div class="container mx-auto px-4 flex flex-col items-center justify-center h-full">
    <button class="absolute top-8 right-4" id="close-button">
      <X className="text-primary-purple" />
    </button>
    <nav class="flex flex-col items-center space-y-8">
      <a href="/services" class="text-2xl text-primary-purple hover:text-accent-green transition-colors">Services</a>
      <a href="/about" class="text-2xl text-primary-purple hover:text-accent-green transition-colors">About Us</a>
      <a href="/team" class="text-2xl text-primary-purple hover:text-accent-green transition-colors">Team</a>
      <a href="/#contact" class="text-2xl text-primary-purple hover:text-accent-green transition-colors">Contact Us</a>
    </nav>
  </div>
</div>

<style>
  #main-header {
    color: white;
  }

  #main-header a {
    color: white;
  }

  #main-header.scrolled {
    /* New: Dark purple background for the scrolled header */
    background-color: rgba(46, 26, 74, 0.9); /* primary-purple at 90% opacity */
    backdrop-filter: blur(8px);
  }
  
  #main-header.scrolled #desktop-nav a {
    /* Ensure nav links remain white */
    color: white;
  }

  #main-header.scrolled #desktop-nav a:hover {
    /* A lighter purple/pink for hover on the dark background */
    color: #E0CFFC;
  }

  #main-header #desktop-nav a:hover {
    color: #E0CFFC;
  }

  #menu-icon {
    color: white;
  }

  #main-header.scrolled #menu-icon {
     /* Ensure menu icon remains white */
    color: white;
  }
</style>

<script>
  // Mobile menu toggle
  const menuButton = document.getElementById('menu-button');
  const closeButton = document.getElementById('close-button');
  const mobileMenu = document.getElementById('mobile-menu');

  if (menuButton && closeButton && mobileMenu) {
    menuButton.addEventListener('click', () => {
      mobileMenu.classList.remove('hidden');
    });

    closeButton.addEventListener('click', () => {
      mobileMenu.classList.add('hidden');
    });

    // Close menu if clicking outside of it
    mobileMenu.addEventListener('click', (e) => {
      if (e.target === mobileMenu) {
        mobileMenu.classList.add('hidden');
      }
    });
  }

  // Header scroll effect
  const header = document.getElementById('main-header');
  const isHomepage = document.location.pathname === '/';

  if (header && isHomepage) {
    const heroSectionHeight = window.innerHeight;
    const headerHeight = header.offsetHeight;

    window.addEventListener('scroll', () => {
      if (window.scrollY > heroSectionHeight - headerHeight) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    });
  }
</script>
